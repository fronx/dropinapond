{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://dropinapond.org/schemas/ego_graph_v02.json",
  "title": "Ego Graph v0.2",
  "description": "Schema for v0.2 ego graphs with phrase-level semantic fields. Embeddings are stored separately in ChromaDB, not in this JSON.",
  "type": "object",
  "required": ["version", "self", "connections", "edges"],
  "properties": {
    "version": {
      "type": "string",
      "const": "0.2",
      "description": "Schema version (must be '0.2')"
    },
    "self": {
      "description": "The focal node (the person whose ego graph this is)",
      "$ref": "#/definitions/node"
    },
    "connections": {
      "type": "array",
      "description": "List of connected nodes (neighbors)",
      "items": {
        "$ref": "#/definitions/node"
      }
    },
    "edges": {
      "type": "array",
      "description": "List of edges between nodes",
      "items": {
        "$ref": "#/definitions/edge"
      }
    },
    "metadata": {
      "type": "object",
      "description": "Optional metadata about the ego graph",
      "properties": {
        "created_at": {"type": "string", "format": "date"},
        "updated_at": {"type": "string", "format": "date"},
        "description": {"type": "string"}
      }
    },
    "contact_points": {
      "type": "object",
      "description": "Historical and potential future contact events",
      "properties": {
        "past": {
          "type": "array",
          "items": {"$ref": "#/definitions/contact_event"}
        },
        "present": {
          "type": "array",
          "items": {"$ref": "#/definitions/contact_event"}
        },
        "potential": {
          "type": "array",
          "items": {"$ref": "#/definitions/contact_event"}
        }
      }
    }
  },
  "definitions": {
    "node": {
      "type": "object",
      "required": ["id", "name", "phrases"],
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the node",
          "minLength": 1
        },
        "name": {
          "type": "string",
          "description": "Human-readable name of the person",
          "minLength": 1
        },
        "phrases": {
          "type": "array",
          "description": "List of phrases representing the person's semantic field",
          "items": {
            "$ref": "#/definitions/phrase"
          }
        },
        "capabilities": {
          "type": "array",
          "description": "Optional list of actionable skills/expertise this person has",
          "items": {"type": "string"}
        },
        "availability": {
          "type": "array",
          "description": "Optional timestamped availability/life circumstances",
          "items": {"$ref": "#/definitions/availability"}
        },
        "notes": {
          "type": "array",
          "description": "Optional free-form qualitative observations",
          "items": {"$ref": "#/definitions/note"}
        },
        "metadata": {
          "type": "object",
          "description": "Optional metadata about the node"
        }
      }
    },
    "phrase": {
      "type": "object",
      "required": ["text", "last_updated"],
      "properties": {
        "text": {
          "type": "string",
          "description": "The phrase text (will be embedded via ChromaDB)",
          "minLength": 1
        },
        "weight": {
          "type": "number",
          "description": "Optional weight/importance of the phrase (defaults to 1.0)",
          "minimum": 0,
          "default": 1.0
        },
        "last_updated": {
          "type": "string",
          "format": "date",
          "description": "Date when this phrase was last mentioned (YYYY-MM-DD)"
        },
        "metadata": {
          "type": "object",
          "description": "Optional metadata (e.g., source, context)"
        }
      }
    },
    "edge": {
      "type": "object",
      "required": ["source", "target"],
      "properties": {
        "source": {
          "type": "string",
          "description": "ID of the source node"
        },
        "target": {
          "type": "string",
          "description": "ID of the target node"
        },
        "actual": {
          "oneOf": [
            {
              "type": "number",
              "description": "Simple scalar for actual interaction strength",
              "minimum": 0,
              "maximum": 1
            },
            {
              "type": "object",
              "description": "Temporal dimensions of actual interaction",
              "properties": {
                "past": {"type": "number", "minimum": 0, "maximum": 1},
                "present": {"type": "number", "minimum": 0, "maximum": 1},
                "future": {"type": "number", "minimum": 0, "maximum": 1}
              }
            }
          ]
        },
        "potential": {
          "type": "number",
          "description": "Potential interaction strength (projected mutual predictability)",
          "minimum": 0,
          "maximum": 1
        },
        "metadata": {
          "type": "object",
          "description": "Optional metadata about the edge"
        }
      }
    },
    "availability": {
      "type": "object",
      "required": ["date", "score", "content"],
      "properties": {
        "date": {
          "type": "string",
          "format": "date",
          "description": "Date of this availability snapshot (YYYY-MM-DD)"
        },
        "score": {
          "type": "number",
          "description": "Availability score (0-1, where 1 is fully available)",
          "minimum": 0,
          "maximum": 1
        },
        "content": {
          "type": "string",
          "description": "Description of availability/life circumstances"
        }
      }
    },
    "note": {
      "type": "object",
      "required": ["date", "content"],
      "properties": {
        "date": {
          "type": "string",
          "format": "date",
          "description": "Date of this note (YYYY-MM-DD)"
        },
        "content": {
          "type": "string",
          "description": "Free-form note content"
        }
      }
    },
    "contact_event": {
      "type": "object",
      "required": ["people", "content"],
      "properties": {
        "date": {
          "type": "string",
          "description": "Date or time period (e.g., '2024-05' or '2019')"
        },
        "people": {
          "type": "array",
          "description": "Node IDs involved in this event",
          "items": {"type": "string"},
          "minItems": 1
        },
        "channels": {
          "type": "array",
          "description": "Communication channels used for this contact",
          "items": {"type": "string"}
        },
        "frequency": {
          "type": "string",
          "description": "How often this contact occurs (e.g., 'weekly', 'monthly', 'sporadic')"
        },
        "content": {
          "type": "string",
          "description": "Description of the contact event"
        }
      }
    }
  }
}
